<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="/layout/header :: headerFragment"/>
<body>
  <div class="password_confirm">
    <h5 class="password_title">
      <strong>로그인</strong>
    </h5>
    <section>
      <label class="password_field_title">이메일</label>
      <label class="password_field">
        <input type="text" name="email" id="email" class="required" title="이메일"/>
      </label>
       <label class="password_field_title">비밀번호</label>
       <label class="password_field">
         <input type="password" name="password" id="password" class="required" title="비밀번호"/>
       </label>
    </section>
    <div class="bt_wrap">
      <a href="#" class="on" id="loginBtn">로그인</a>
      <a href="#" class="" id="cancelBtn">취소</a>
    </div>
  </div>
  <form id="loginForm" method="get">
  </form>
</body>
<th:block th:replace="/layout/footer :: footerFragment"/>
<script th:inline="javascript">
  $(document).ready(function(){
    $(".bt_wrap #loginBtn").click(function(e){
      if(common.validate.checkRequired(".password_confirm .required")){
        let dataJson = {};
        dataJson.email = $("#email").val();
        dataJson.password = $("#password").val();

        $.ajax({
          url: '/login',
          method: 'post',
          contentType: 'application/json',
          data: JSON.stringify(dataJson),
          success: function(res){
            let lf = $("#loginForm");
            lf.attr("action","/posts");
            lf.submit();
          },
          error: function(res){
            let responseJson = res.responseJSON;
            let rCode = responseJson.code;
            let rMessage = responseJson.message;

            if(rMessage != null){
              alert(rMessage+"(오류코드 : "+rCode+")");
            }else{
              alert("로그인에 실패하였습니다. (오류코드 : "+rCode+")");
            }
          }
        });
      }
    });

    $(".bt_wrap #cancelBtn").click(function(e){
      e.preventDefault();
      window.history.back();
    });
  });

</script>
</html>